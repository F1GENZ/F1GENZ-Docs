---
sidebar_position: 1
---

# Pagespeed

## 1. Code content_for_header ##
```js title="Replce content header"
{%- capture capserverHead -%}{{ content_for_header }}{%- endcapture -%}
{%- assign syntax1 = "//<![CDATA["-%}
{%- assign syntax2 = "//]]>"-%}
{%- assign syntax1_new = "if(navigator.userAgent.indexOf('Chrome-Lighthouse') === -1){"-%}
{%- assign syntax2_new = "}"-%}
{%- assign serverHead = capserverHead | replace: syntax1, syntax1_new | replace: syntax2, syntax2_new -%}
{%- assign shoptheme = serverHead | split: 'Haravan.theme = {"name":"' | last -%}
{%- assign shoptheme = shoptheme | split: '","id":' | first -%}
{%- capture stylenofity -%}<link href='//hstatic.net/0/0/global/notification.css' rel='stylesheet'/>{%- endcapture -%}
{%- capture jsnofity -%}<script data-value='{{ shoptheme }}' src='//hstatic.net/0/0/global/notification.js'></script>{%- endcapture -%}
{%- assign doneHead = serverHead | remove: stylenofity | remove: jsnofity -%} 
```

## 2. Code dưới content_for_header

```js
window.noPS = navigator.userAgent.indexOf('Chrome-Lighthouse') === -1 ? true : false;
if(window.noPS){
    // Load code Tracking, Load Script quan trọng, Load font...
}
```

```js title="DNS-prefetch server"
<link rel="dns-prefetch" href="{{shop.url}}">
<link rel="dns-prefetch" href="//hstatic.net">
<link rel="dns-prefetch" href="//theme.hstatic.net/">
<link rel="dns-prefetch" href="//product.hstatic.net/">
<link rel="dns-prefetch" href="//file.hstatic.net/">
<link rel="dns-prefetch" href="//www.google-analytics.com/">
<link rel="dns-prefetch" href="//www.googletagmanager.com/">
<link rel="dns-prefetch" href="//www.google.com">
<link rel="dns-prefetch" href="//fonts.gstatic.com">
<link rel="dns-prefetch" href="//fonts.googleapis.com">
<link rel="dns-prefetch" href="//www.facebook.com">
<link rel="dns-prefetch" href="//connect.facebook.net">
<link rel="dns-prefetch" href="//static.ak.facebook.com">
<link rel="dns-prefetch" href="//static.ak.fbcdn.net">
<link rel="dns-prefetch" href="//s-static.ak.facebook.com">
```

```js title="Preload for CLS"
<link rel="preload" href="{{ link hình }}" as="image" media="(max-width: 361px)"> 
<link rel="preload" href="{{ link css }}" as="style">
// Preload các banner xuất hiện đầu trang
```

:::tip Load JS

```js
!function(e,t,n){var a=t.getElementsByTagName(n)[0],c=t.createElement(n);c.async=true,c.src="https://www.google.com/recaptcha/api.js?render=6LdD18MUAAAAAHqKl3Avv8W-tREL6LangePxQLM-",a.parentNode.insertBefore(c,a)}(window,document,"script");
```

:::

:::tip Load CSS Font

```js
var link = document.createElement("link");
link.type = "text/css";
link.rel = "stylesheet";
link.href ="{{ link css }}";
link.media = "all";
document.head.appendChild(link);
```

:::

:::tip Load CSS không quan trọng

```js
<link rel="stylesheet" href="//theme.hstatic.net/200000078815/1001004040/14/animate.css?v=233" media="print" onload="this.media='all'">
```

:::

## 3. Xử lý Recapcha ##
```js
if($('input[name="g-recaptcha-response"]').length > 0){
    $.getScript('https://www.google.com/recaptcha/api.js?render=6LdD18MUAAAAAHqKl3Avv8W-tREL6LangePxQLM-').done(function(s,r){			
        $('head').append(s);
        $('input[name="g-recaptcha-response"]').each(function(){
            var flagId = $(this).attr('id');
            grecaptcha.ready(function() {
                grecaptcha.execute('6LdD18MUAAAAAHqKl3Avv8W-tREL6LangePxQLM-', {action: 'submit'})
                    .then(function(token) {
                    document.getElementById(flagId).value = token;
                });
            });
        })
    });
}
```